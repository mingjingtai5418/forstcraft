import{_ as o,c,o as h,ah as d,J as l,k as m,ai as p,aj as f}from"./chunks/framework.DiVQWqr_.js";import{V as g}from"./chunks/theme.CutOQIek.js";class b{constructor(e){this.relativePath=e,this.url=null,this.ws=null,this.intervalId=null,this.listeners=new Array(4),this.time=0n,this.buf=new ArrayBuffer(12),this.reconnectAttempts=0,this.maxReconnectAttempts=3}connect(){this.ws&&this.ws.close(),this.listeners||(this.listeners=new Array(4));try{const e=new WebSocket(this.url);e.binaryType="arraybuffer",e.onopen=()=>{console.log("WebSocket connected"),this.reconnectAttempts=0,this.intervalId=setInterval(()=>{this.sendMessage(0)},2e4)},e.onmessage=t=>{try{const a=t.data,r=new DataView(a),n=this.listeners[r.getInt32(8)];n&&n(r.getBigInt64(),new DataView(a,12))}catch(a){console.error("WebSocket message error:",a)}},e.onclose=()=>{console.log("WebSocket closed"),this.listeners=null,clearInterval(this.intervalId),this.intervalId=null,this.reconnectAttempts<this.maxReconnectAttempts&&(this.reconnectAttempts++,console.log(`Attempting to reconnect... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect()},5e3))},e.onerror=t=>{console.warn("WebSocket connection error (expected in preview mode):",t.message)},this.ws=e}catch(e){console.warn("Failed to create WebSocket connection (expected in preview mode):",e.message)}}sendMessage(e,t=this.time){if(this.ws&&this.ws.readyState===WebSocket.OPEN){const a=new DataView(this.buf);a.setBigInt64(0,t),a.setInt32(8,e),this.ws.send(this.buf)}else console.error("WebSocket is not connected")}addListener(e,t){this.listeners[e]=t}setUrl(e){const t=new URL(this.relativePath,e.origin);t.protocol=t.protocol==="https:"?"wss:":"ws:",this.url=t.href,this.relativePath=null}}const s=new b("/mc/home"),u=new TextDecoder("utf-8");class k{constructor(e){this.index=0,this.mspt=e.mspt10.map(t=>(t/10).toFixed(1)),this.ram=e.ram,this.entities=e.entities,this.chunks=e.chunks,this.inb=(e.inb/1024).toFixed(2),this.oub=(e.oub/1024).toFixed(2)}}const v={data(){return{Mark:{TIMEOUT:-1,LOADING:0,ONLINE:1,OFFLINE:2,ERROR:3},basic:null,cache:null,players:null,basicTime:0n,playerTime:0n,intervalId:null,tick:0,mark:0,errorMessage:""}},methods:{handleOffline(i){this.basicTime<i&&(s.time=this.basicTime=i,this.mark!==this.Mark.OFFLINE&&(this.mark=this.Mark.OFFLINE,this.basic=this.cache=null),this.tick=-190)},handleBasicInfo(i,e){if(this.basicTime<i){this.basicTime=i;const t={};t.mspt10=new Array(10);for(let a=0;a<10;++a)t.mspt10[a]=e.getInt16(a<<1);t.ram=new Int16Array(10);for(let a=0;a<10;++a)t.ram[a]=e.getInt16(20+(a<<1));t.entities=e.getInt32(40),t.chunks=e.getInt32(44),t.inb=e.getInt32(48),t.oub=e.getInt32(52),this.cache=t}},handlePlayerInfo(i,e){this.playerTime<i&&(s.time=this.playerTime=i,this.players=JSON.parse(u.decode(e)))},clear(){clearInterval(this.intervalId),this.intervalId=null,s.ws?.close()},tickBasic(){const i=++this.tick,e=this.cache;this.mark===this.Mark.ONLINE&&i<10&&this.basic!==null?this.basic.index=i:e!==null?(this.basic=new k(e),this.cache=null,this.mark=this.Mark.ONLINE,this.tick=0):i>16&&(this.mark===this.Mark.ONLINE||this.mark===this.Mark.OFFLINE)?(this.mark=this.Mark.LOADING,this.basic=null,s.sendMessage(0,this.basicTime)):i>100&&this.mark!==this.Mark.TIMEOUT&&(this.mark=this.Mark.TIMEOUT,this.basic=this.cache=this.players=null,this.clear())}},mounted(){window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?(console.log("WebSocket connection disabled in preview mode"),this.mark=this.Mark.OFFLINE):(s.setUrl(window.location),s.addListener(0,this.handleOffline),s.addListener(1,this.handleBasicInfo),s.addListener(2,this.handlePlayerInfo),s.connect(),this.intervalId=setInterval(this.tickBasic,100))},beforeDestroy(){this.clear()}},I=o(v,[["__scopeId","data-v-b0b22c0d"]]),M=JSON.parse('{"title":"","description":"","frontmatter":{"layout":"home","hero":{"name":"FrostCraft服务器","text":"MC 1.21 全版本生存服","tagline":"服务器地址:orwoe.cn","actions":[{"theme":"brand","text":"服务器介绍","link":"/guide/"},{"theme":"alt","text":"卫星地图","link":"http://map.orwoe.cn/"},{"theme":"brand","text":"检控面板","link":"http://plan.orwoe.cn/"}]}},"headers":[],"relativePath":"index.md","filePath":"index.md"}'),w={name:"index.md"},P=Object.assign(w,{setup(i){const e=[{avatar:"/team/MY.jpg",name:"MGyue_",title:"练习时长两年半"},{avatar:"/team/LU.jpg",name:"lullaby_ouo",title:"瓜类鉴别家"},{avatar:"/team/YUS.jpg",name:"Y_u_S",title:"大日本双料高级特工"},{avatar:"/team/b_29eeeQC.jpg",name:"QQCCQQLLQQ",title:"70多岁武学大师"},{avatar:"/team/FU.jpg",name:"fusces_",title:"美食家"},{avatar:"/team/xiaobai.jpg",name:"xiaobai23345",title:"秦始皇坐骑"}];return(t,a)=>(h(),c("div",null,[a[0]||(a[0]=d("",19)),l(m(g),{size:"medium",members:e}),l(I)]))}});export{M as __pageData,P as default};
